<!DOCTYPE html>
{{ 
    use lg;         // Function publish use context lg
    use page;       // Function publish use context page for the content of the page
    use user;       // From sn_preload
    use grid;       // In sn_publish grid is initialize 
    
    use structure;      // loop from the publish over sn_structure
    use ressource;    

    %include "/extenso/functions/sn_ct.snc"; 
    %include "/extenso/functions/sn_widgets.snc"; 
}}
\{{ 
    config=config(); 
    page={"uid":"{{page.rows.uid}}",
        "url":"{{page.rows{'folder_' .+ lg.rows.lg}; 
        page.rows{'page_' .+ lg.rows.lg};}}"}; // use by menus
}}
<html lang="{{lg.rows.lg}}">
    <head>
        {{ %include "/includes/header.sn"; }}
        <!-- Generated by {{ 
                user.username; " " ; datetime();  " "; 
                files = filenames(); 
                for file in files.filenames do 
                    file; " ;  "; 
                    endfor 
        }} -->
    </head>
    <body class="site">
        \{{ 
            if config.site eq "staging" then 
                client_has_bootstrap = true; 
                if user.lg ne "" then
                    include("/extenso/html/extranet/" .+ user.lg .+ "/fullpage.snc");
                else
                    include("/extenso/html/extranet/fr/fullpage.snc"); 
                endif
            endif
        }}
        <div class="cs sed">
            \{{ include("/" .+ config.site .+ "/includes/{{lg.rows.lg}}/header.snc"); }}
            
            
           {{ nb_widget = sql(single:true,"select count(*) as nb from sn_widgets_list where position = 'haut' and uid_page = '?' and table_name = 'pages'", page.rows.uid);
                if nb_widget.rows.nb == 0 then 
            }}  
                {{ sn_widgets(add:true,table:"pages",uid:page.rows.uid,lg:lg,position:"haut"); }}
            {{ else }}
                {{ sn_widgets(add:true,table:"pages",uid:page.rows.uid,lg:lg,position:"haut"); }}
            {{ endif }}
            
            
            <div class="cs-main-content">
               \{{
                   cgidata = cgidata();
                   code = cgidata.u;
                   error = 1;
                   if code ne "" then
                       user_email=decrypt(value:code,key:"SednoveInfolettr",error:decrypt_err);
                       error = decrypt_err.errcode + 0;
                       if error==0 then
                          void sql("UPDATE contacts SET newsletter_confirmation_status='confirmed' WHERE email='?'",user_email); 
                       endif
                   endif                      
               }}  
               \{{ if error > 0 then }}    
                <div class="alert alert-danger fade in" id="contact-alert-danger2">
                    {{sn_ct("contact newsletter confirmation error!", publish:"/publish/ressources.sn",uids:ressource.rows.uid,module:"contacts")}}
                </div>
               \{{ else }}     
                <div class="alert alert-success fade in" id="contact-alert-success2">
                    {{sn_ct("contact Confirmation success!", publish:"/publish/ressources.sn",uids:ressource.rows.uid,module:"contacts")}}
                </div>               
               \{{ endif }}  
            </div>
            
            \{{ include("/" .+ config.site .+ "/includes/{{lg.rows.lg}}/footer.snc"); }}
        </div><!--/.cs-->
        {{ %include "/includes/footer.sn"; }}
    </body>
</html>