<!DOCTYPE html>
{{ 
    use lg;         // Function publish use context lg
    use page;       // Function publish use context page for the content of the page
    use user;       // From sn_preload
    use grid;       // In sn_publish grid is initialize 

    %include "/extenso/functions/sn_ct.snc"; 
    %include "/extenso/functions/sn_widgets.snc"; 
	if page.rows{'page_' .+ lg.rows.lg} ne "index" then
		pageurl = page.rows{'folder_' .+ lg.rows.lg} .+ page.rows{'page_' .+ lg.rows.lg};
	else
		pageurl = page.rows{'folder_' .+ lg.rows.lg};
	endif // use by menus
}}
\{{ 
    config=config(); 
	page={	"uid":"{{page.rows.uid}}", 
			"url":"{{pageurl}}" 
			{{ for l sql("select * from sn_languages where active = 'yes'") do }}
				,"url_{{l.rows.lg}}":"{{page.rows{'folder_' .+ l.rows.lg};
				if page.rows{'page_' .+ l.rows.lg} ne "index" then
					page.rows{'page_' .+ l.rows.lg};
				endif
			}}"
			{{ endfor }}
	}; 
}}
<html lang="{{lg.rows.lg}}">
    <head>
        {{ %include "/includes/header.sn"; }}
        <!-- Generated by {{ 
                user.username; " " ; datetime();  " "; 
                files = filenames(); 
                for file in files.filenames do 
                    file; " ;  "; 
                    endfor 
        }} -->
    </head>
    <body class="site">
        \{{ 
            if config.site eq "staging" then 
                client_has_bootstrap = true; 
                if user.lg ne "" then
                    include("/extenso/html/extranet/" .+ user.lg .+ "/fullpage.snc");
                else
                    include("/extenso/html/extranet/fr/fullpage.snc"); 
                endif
            endif
        }}
        <div class="cs sed">
			\{{ include("/" .+ config.site .+ "/includes/{{lg.rows.lg}}/header.snc"); }}

           <div class="widget_area_top">
              {{ nb_widget = sql(single:true,"select count(*) as nb from sn_widgets_list where position = 'haut' and uid_page = '?' and table_name = 'pages'", page.rows.uid);
                  if nb_widget.rows.nb == 0 then 
              }}	
                  {{ sn_widgets(add:true,table:"pages",uid:page.rows.uid,lg:lg,position:"haut"); }}
              {{ else }}
                  {{ sn_widgets(add:true,table:"pages",uid:page.rows.uid,lg:lg,position:"haut"); }}
              {{ endif }}
            </div>
            
            <div class="cs-main-content">
              {{ // --------------- Implement Grid
                  uid_grid = grid.rows.uid;
                  grid = unstringnify(grid.rows.grid);
                  %include "/includes/show_grid.sn"; 
              }}
            </div>

			\{{ include("/" .+ config.site .+ "/includes/{{lg.rows.lg}}/footer.snc"); }}
        </div><!--/.cs-->
         
        {{ // ---- FOOTER FOR THE GOOGLE ANALYTICS ----- }}
		{{ %include "/includes/footer.sn"; }}
     
    </body>
</html>