<!DOCTYPE html>
{{ 
    use lg;         // Function publish use context lg
    use page;       // Function publish use context page for the content of the page
    use user;       // From sn_preload
    use grid;       // In sn_publish grid is initialize 

    %include "/extenso/functions/sn_ct.snc"; 
    %include "/extenso/functions/sn_widgets.snc"; 

	settings = sql(single:true,"select * from sn_configs");
}}
\{{ 
    config=config(); 
    page={"uid":"{{page.rows.uid}}",
    		"url":"{{page.rows{'folder_' .+ lg.rows.lg}; page.rows{'page_' .+ lg.rows.lg};}}"
            {{ for l sql("select * from sn_languages where active = 'yes'") do }}
                ,"url_{{l.rows.lg}}":"{{page.rows{'folder_' .+ l.rows.lg};
                if page.rows{'page_' .+ l.rows.lg} ne "index" then
                    page.rows{'page_' .+ l.rows.lg};
                endif
                }}"
            {{ endfor }}
	}; // use by menus

	settings.url_prod = "{{settings.rows.url_prod}}";
	settings.url_staging = "{{settings.rows.url_staging}}";
	if config.site eq "staging" then
		settings.url = settings.url_staging;
	else	
		settings.url = settings.url_prof;
	endif
}}
<html lang="{{lg.rows.lg}}">
    <head>
        {{ %include "/includes/header.sn"; }}
        <!-- Generated by {{ 
                user.username; " " ; datetime();  " "; 
                files = filenames(); 
                for file in files.filenames do 
                    file; " ;  "; 
                    endfor 
        }} -->
    </head>
    <body class="site">
        \{{ 
            if config.site eq "staging" then 
                client_has_bootstrap = true; 
                if user.lg ne "" then
                    include("/extenso/html/extranet/" .+ user.lg .+ "/fullpage.snc");
                else
                    include("/extenso/html/extranet/fr/fullpage.snc"); 
                endif
            endif
        }}
        <div class="cs sed">
            \{{ include("/" .+ config.site .+ "/includes/{{lg.rows.lg}}/header.snc"); }}
            
            
           
            {{ nb_widget = sql(single:true,"select count(*) as nb from sn_widgets_list where position = 'haut' and uid_page = '?' and table_name = 'pages'", page.rows.uid);
                if nb_widget.rows.nb == 0 then 
            }}	
                {{ sn_widgets(add:true,table:"pages",uid:page.rows.uid,lg:lg,position:"haut"); }}
            {{ else }}
                {{ sn_widgets(add:true,table:"pages",uid:page.rows.uid,lg:lg,position:"haut"); }}
            {{ endif }}
            
            
            <div class="cs-main-content">
              {{ // ----------------------------- Implement Grid
                  uid_grid = grid.rows.uid;
                  grid = unstringnify(grid.rows.grid);
                  %include "/includes/show_grid.sn"; 
              }}
            </div>
            
            \{{ include("/" .+ config.site .+ "/includes/{{lg.rows.lg}}/footer.snc"); }}
        </div><!--/.cs-->
        {{ %include "/includes/footer.sn"; }}
    </body>
</html>